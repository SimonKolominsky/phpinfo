<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link href="/../deepseek.css" rel="stylesheet">

</head>
<body>
<div class="ds-markdown ds-markdown--block" style="--ds-md-zoom: 1.143;"><p>Шаблоны проектирования в ORM
    (Object-Relational Mapping) помогают структурировать код, упрощают взаимодействие с базой данных и делают его более
    поддерживаемым. В PHP, особенно при использовании ORM, таких как Doctrine или Eloquent, часто применяются следующие
    шаблоны:</p>
    <hr>
    <h3>1. <strong>Active Record</strong></h3>
    <p>Этот шаблон предполагает, что объект модели соответствует строке в таблице базы данных. Объект отвечает за
        сохранение, обновление и удаление данных.</p>
    <p><strong>Пример:</strong></p>
    <div class="md-code-block">
        <div class="md-code-block-banner-wrap">
            <div class="md-code-block-banner">
                <div class="md-code-block-infostring">php</div>
                <div class="md-code-block-action">
                    <div class="ds-markdown-code-copy-button">Copy</div>
                </div>
            </div>
        </div>
        <pre><span class="token keyword">class</span> <span
                class="token class-name-definition class-name">User</span> <span
                class="token keyword">extends</span> <span class="token class-name class-name-fully-qualified"><span
                class="token punctuation">\</span>Illuminate<span class="token punctuation">\</span>Database<span
                class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span> <span
                class="token punctuation">{</span>
    <span class="token comment">// Eloquent автоматически связывает модель с таблицей 'users'</span>
<span class="token punctuation">}</span>

<span class="token comment">// Создание нового пользователя</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span
                    class="token keyword">new</span> <span class="token class-name">User</span><span
                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span
                    class="token property">name</span> <span class="token operator">=</span> <span
                    class="token string single-quoted-string">'John Doe'</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span
                    class="token property">email</span> <span class="token operator">=</span> <span
                    class="token string single-quoted-string">'john@example.com'</span><span
                    class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span
                    class="token function">save</span><span class="token punctuation">(</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Поиск пользователя</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span
                    class="token class-name static-context">User</span><span class="token operator">::</span><span
                    class="token function">find</span><span class="token punctuation">(</span><span
                    class="token number">1</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$user</span><span
                    class="token operator">-&gt;</span><span class="token property">name</span><span
                    class="token punctuation">;</span></pre>
    </div>
    <p><strong>Плюсы:</strong></p>
    <ul>
        <li><p>Простота использования.</p></li>
        <li><p>Минимальный объем кода.</p></li>
    </ul>
    <p><strong>Минусы:</strong></p>
    <ul>
        <li><p>Нарушение принципа единственной ответственности (модель знает о базе данных).</p></li>
        <li><p>Сложность тестирования.</p></li>
    </ul>
    <hr>
    <h3>2. <strong>Data Mapper</strong></h3>
    <p>Этот шаблон разделяет модель и логику работы с базой данных. Модель не знает, как данные сохраняются или
        извлекаются, этим занимается отдельный класс — Data Mapper.</p>
    <p><strong>Пример:</strong></p>
    <div class="md-code-block">
        <div class="md-code-block-banner-wrap">
            <div class="md-code-block-banner">
                <div class="md-code-block-infostring">php</div>
                <div class="md-code-block-action">
                    <div class="ds-markdown-code-copy-button">Copy</div>
                </div>
            </div>
        </div>
        <pre><span class="token keyword">class</span> <span
                class="token class-name-definition class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$id</span><span
                    class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span
                    class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$email</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">UserMapper</span> <span
                    class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$pdo</span><span
                    class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">__construct</span><span
                    class="token punctuation">(</span><span
                    class="token class-name class-name-fully-qualified type-declaration"><span
                    class="token punctuation">\</span>PDO</span> <span class="token variable">$pdo</span><span
                    class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">pdo</span> <span
                    class="token operator">=</span> <span class="token variable">$pdo</span><span
                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">save</span><span class="token punctuation">(</span><span
                    class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span
                    class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span
                    class="token variable">$user</span><span class="token operator">-&gt;</span><span
                    class="token property">id</span><span class="token punctuation">)</span> <span
                    class="token punctuation">{</span>
            <span class="token comment">// Обновление</span>
            <span class="token variable">$stmt</span> <span class="token operator">=</span> <span
                    class="token variable">$this</span><span class="token operator">-&gt;</span><span
                    class="token property">pdo</span><span class="token operator">-&gt;</span><span
                    class="token function">prepare</span><span class="token punctuation">(</span><span
                    class="token string double-quoted-string">"UPDATE users SET name = ?, email = ? WHERE id = ?"</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span
                    class="token function">execute</span><span class="token punctuation">(</span><span
                    class="token punctuation">[</span><span class="token variable">$user</span><span
                    class="token operator">-&gt;</span><span class="token property">name</span><span
                    class="token punctuation">,</span> <span class="token variable">$user</span><span
                    class="token operator">-&gt;</span><span class="token property">email</span><span
                    class="token punctuation">,</span> <span class="token variable">$user</span><span
                    class="token operator">-&gt;</span><span class="token property">id</span><span
                    class="token punctuation">]</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span
                    class="token punctuation">{</span>
            <span class="token comment">// Вставка</span>
            <span class="token variable">$stmt</span> <span class="token operator">=</span> <span
                    class="token variable">$this</span><span class="token operator">-&gt;</span><span
                    class="token property">pdo</span><span class="token operator">-&gt;</span><span
                    class="token function">prepare</span><span class="token punctuation">(</span><span
                    class="token string double-quoted-string">"INSERT INTO users (name, email) VALUES (?, ?)"</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span
                    class="token function">execute</span><span class="token punctuation">(</span><span
                    class="token punctuation">[</span><span class="token variable">$user</span><span
                    class="token operator">-&gt;</span><span class="token property">name</span><span
                    class="token punctuation">,</span> <span class="token variable">$user</span><span
                    class="token operator">-&gt;</span><span class="token property">email</span><span
                    class="token punctuation">]</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
            <span class="token variable">$user</span><span class="token operator">-&gt;</span><span
                    class="token property">id</span> <span class="token operator">=</span> <span class="token variable">$this</span><span
                    class="token operator">-&gt;</span><span class="token property">pdo</span><span
                    class="token operator">-&gt;</span><span class="token function">lastInsertId</span><span
                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">find</span><span class="token punctuation">(</span><span
                    class="token variable">$id</span><span class="token punctuation">)</span> <span
                    class="token punctuation">{</span>
        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span
                    class="token operator">-&gt;</span><span class="token property">pdo</span><span
                    class="token operator">-&gt;</span><span class="token function">prepare</span><span
                    class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT * FROM users WHERE id = ?"</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span
                    class="token punctuation">(</span><span class="token punctuation">[</span><span
                    class="token variable">$id</span><span class="token punctuation">]</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$stmt</span><span
                    class="token operator">-&gt;</span><span class="token function">fetch</span><span
                    class="token punctuation">(</span><span
                    class="token class-name class-name-fully-qualified static-context"><span
                    class="token punctuation">\</span>PDO</span><span class="token operator">::</span><span
                    class="token constant">FETCH_ASSOC</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span
                    class="token variable">$data</span><span class="token punctuation">)</span> <span
                    class="token punctuation">{</span>
            <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span
                    class="token class-name">User</span><span class="token punctuation">(</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$user</span><span class="token operator">-&gt;</span><span
                    class="token property">id</span> <span class="token operator">=</span> <span class="token variable">$data</span><span
                    class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span
                    class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$user</span><span class="token operator">-&gt;</span><span
                    class="token property">name</span> <span class="token operator">=</span> <span
                    class="token variable">$data</span><span class="token punctuation">[</span><span
                    class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span
                    class="token punctuation">;</span>
            <span class="token variable">$user</span><span class="token operator">-&gt;</span><span
                    class="token property">email</span> <span class="token operator">=</span> <span
                    class="token variable">$data</span><span class="token punctuation">[</span><span
                    class="token string single-quoted-string">'email'</span><span
                    class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token variable">$user</span><span
                    class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token constant">null</span><span
                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Использование</span>
<span class="token variable">$pdo</span> <span class="token operator">=</span> <span
                    class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span
                    class="token punctuation">\</span>PDO</span><span class="token punctuation">(</span><span
                    class="token string single-quoted-string">'mysql:host=localhost;dbname=test'</span><span
                    class="token punctuation">,</span> <span
                    class="token string single-quoted-string">'user'</span><span
                    class="token punctuation">,</span> <span class="token string single-quoted-string">'password'</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$mapper</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span
                    class="token class-name">UserMapper</span><span class="token punctuation">(</span><span
                    class="token variable">$pdo</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>

<span class="token variable">$user</span> <span class="token operator">=</span> <span
                    class="token keyword">new</span> <span class="token class-name">User</span><span
                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span
                    class="token property">name</span> <span class="token operator">=</span> <span
                    class="token string single-quoted-string">'Jane Doe'</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span
                    class="token property">email</span> <span class="token operator">=</span> <span
                    class="token string single-quoted-string">'jane@example.com'</span><span
                    class="token punctuation">;</span>
<span class="token variable">$mapper</span><span class="token operator">-&gt;</span><span
                    class="token function">save</span><span class="token punctuation">(</span><span
                    class="token variable">$user</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>

<span class="token variable">$foundUser</span> <span class="token operator">=</span> <span class="token variable">$mapper</span><span
                    class="token operator">-&gt;</span><span class="token function">find</span><span
                    class="token punctuation">(</span><span class="token variable">$user</span><span
                    class="token operator">-&gt;</span><span class="token property">id</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$foundUser</span><span
                    class="token operator">-&gt;</span><span class="token property">name</span><span
                    class="token punctuation">;</span></pre>
    </div>
    <p><strong>Плюсы:</strong></p>
    <ul>
        <li><p>Разделение ответственности.</p></li>
        <li><p>Упрощение тестирования.</p></li>
    </ul>
    <p><strong>Минусы:</strong></p>
    <ul>
        <li><p>Больше кода.</p></li>
        <li><p>Сложность в реализации.</p></li>
    </ul>
    <hr>
    <h3>3. <strong>Repository</strong></h3>
    <p>Этот шаблон предоставляет абстракцию для доступа к данным. Репозиторий инкапсулирует логику работы с базой
        данных, предоставляя методы для выборки, добавления, обновления и удаления данных.</p>
    <p><strong>Пример:</strong></p>
    <div class="md-code-block">
        <div class="md-code-block-banner-wrap">
            <div class="md-code-block-banner">
                <div class="md-code-block-infostring">php</div>
                <div class="md-code-block-action">
                    <div class="ds-markdown-code-copy-button">Copy</div>
                </div>
            </div>
        </div>
        <pre><span class="token keyword">interface</span> <span class="token class-name-definition class-name">UserRepositoryInterface</span> <span
                class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">find</span><span class="token punctuation">(</span><span
                    class="token variable">$id</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">save</span><span class="token punctuation">(</span><span
                    class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span
                    class="token class-name-definition class-name">UserRepository</span> <span class="token keyword">implements</span> <span
                    class="token class-name">UserRepositoryInterface</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$pdo</span><span
                    class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">__construct</span><span
                    class="token punctuation">(</span><span
                    class="token class-name class-name-fully-qualified type-declaration"><span
                    class="token punctuation">\</span>PDO</span> <span class="token variable">$pdo</span><span
                    class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">pdo</span> <span
                    class="token operator">=</span> <span class="token variable">$pdo</span><span
                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">find</span><span class="token punctuation">(</span><span
                    class="token variable">$id</span><span class="token punctuation">)</span> <span
                    class="token punctuation">{</span>
        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span
                    class="token operator">-&gt;</span><span class="token property">pdo</span><span
                    class="token operator">-&gt;</span><span class="token function">prepare</span><span
                    class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT * FROM users WHERE id = ?"</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span
                    class="token punctuation">(</span><span class="token punctuation">[</span><span
                    class="token variable">$id</span><span class="token punctuation">]</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span
                    class="token function">fetch</span><span class="token punctuation">(</span><span
                    class="token class-name class-name-fully-qualified static-context"><span
                    class="token punctuation">\</span>PDO</span><span class="token operator">::</span><span
                    class="token constant">FETCH_ASSOC</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">save</span><span class="token punctuation">(</span><span
                    class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span
                    class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Логика сохранения</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Использование</span>
<span class="token variable">$pdo</span> <span class="token operator">=</span> <span
                    class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span
                    class="token punctuation">\</span>PDO</span><span class="token punctuation">(</span><span
                    class="token string single-quoted-string">'mysql:host=localhost;dbname=test'</span><span
                    class="token punctuation">,</span> <span
                    class="token string single-quoted-string">'user'</span><span
                    class="token punctuation">,</span> <span class="token string single-quoted-string">'password'</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$repository</span> <span class="token operator">=</span> <span
                    class="token keyword">new</span> <span class="token class-name">UserRepository</span><span
                    class="token punctuation">(</span><span class="token variable">$pdo</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$userData</span> <span class="token operator">=</span> <span class="token variable">$repository</span><span
                    class="token operator">-&gt;</span><span class="token function">find</span><span
                    class="token punctuation">(</span><span class="token number">1</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$userData</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span></pre>
    </div>
    <p><strong>Плюсы:</strong></p>
    <ul>
        <li><p>Абстракция доступа к данным.</p></li>
        <li><p>Упрощение тестирования и замены источника данных.</p></li>
    </ul>
    <p><strong>Минусы:</strong></p>
    <ul>
        <li><p>Дополнительный уровень абстракции.</p></li>
    </ul>
    <hr>
    <h3>4. <strong>Unit of Work</strong></h3>
    <p>Этот шаблон отслеживает изменения объектов и автоматически сохраняет их в базе данных при завершении
        транзакции.</p>
    <p><strong>Пример:</strong></p>
    <div class="md-code-block">
        <div class="md-code-block-banner-wrap">
            <div class="md-code-block-banner">
                <div class="md-code-block-infostring">php</div>
                <div class="md-code-block-action">
                    <div class="ds-markdown-code-copy-button">Copy</div>
                </div>
            </div>
        </div>
        <pre><span class="token keyword">class</span> <span
                class="token class-name-definition class-name">UnitOfWork</span> <span
                class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$newObjects</span> <span
                    class="token operator">=</span> <span class="token punctuation">[</span><span
                    class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$dirtyObjects</span> <span
                    class="token operator">=</span> <span class="token punctuation">[</span><span
                    class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$removedObjects</span> <span
                    class="token operator">=</span> <span class="token punctuation">[</span><span
                    class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">registerNew</span><span
                    class="token punctuation">(</span><span class="token variable">$object</span><span
                    class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">newObjects</span><span
                    class="token punctuation">[</span><span class="token punctuation">]</span> <span
                    class="token operator">=</span> <span class="token variable">$object</span><span
                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">registerDirty</span><span
                    class="token punctuation">(</span><span class="token variable">$object</span><span
                    class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">dirtyObjects</span><span
                    class="token punctuation">[</span><span class="token punctuation">]</span> <span
                    class="token operator">=</span> <span class="token variable">$object</span><span
                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">registerRemoved</span><span
                    class="token punctuation">(</span><span class="token variable">$object</span><span
                    class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">removedObjects</span><span
                    class="token punctuation">[</span><span class="token punctuation">]</span> <span
                    class="token operator">=</span> <span class="token variable">$object</span><span
                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">commit</span><span
                    class="token punctuation">(</span><span class="token punctuation">)</span> <span
                    class="token punctuation">{</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span
                    class="token operator">-&gt;</span><span class="token property">newObjects</span> <span
                    class="token keyword">as</span> <span class="token variable">$object</span><span
                    class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Логика вставки</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span
                    class="token operator">-&gt;</span><span class="token property">dirtyObjects</span> <span
                    class="token keyword">as</span> <span class="token variable">$object</span><span
                    class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Логика обновления</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span
                    class="token operator">-&gt;</span><span class="token property">removedObjects</span> <span
                    class="token keyword">as</span> <span class="token variable">$object</span><span
                    class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Логика удаления</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Использование</span>
<span class="token variable">$uow</span> <span class="token operator">=</span> <span
                    class="token keyword">new</span> <span class="token class-name">UnitOfWork</span><span
                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span
                    class="token keyword">new</span> <span class="token class-name">User</span><span
                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
<span class="token variable">$uow</span><span class="token operator">-&gt;</span><span class="token function">registerNew</span><span
                    class="token punctuation">(</span><span class="token variable">$user</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$uow</span><span class="token operator">-&gt;</span><span
                    class="token function">commit</span><span class="token punctuation">(</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span></pre>
    </div>
    <p><strong>Плюсы:</strong></p>
    <ul>
        <li><p>Упрощение управления изменениями.</p></li>
        <li><p>Автоматизация сохранения.</p></li>
    </ul>
    <p><strong>Минусы:</strong></p>
    <ul>
        <li><p>Сложность реализации.</p></li>
    </ul>
    <hr>
    <h3>5. <strong>Query Object</strong></h3>
    <p>Этот шаблон инкапсулирует логику построения SQL-запросов в отдельные классы.</p>
    <p><strong>Пример:</strong></p>
    <div class="md-code-block">
        <div class="md-code-block-banner-wrap">
            <div class="md-code-block-banner">
                <div class="md-code-block-infostring">php</div>
                <div class="md-code-block-action">
                    <div class="ds-markdown-code-copy-button">Copy</div>
                </div>
            </div>
        </div>
        <pre><span class="token keyword">class</span> <span
                class="token class-name-definition class-name">UserQuery</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$conditions</span> <span
                    class="token operator">=</span> <span class="token punctuation">[</span><span
                    class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">whereName</span><span
                    class="token punctuation">(</span><span class="token variable">$name</span><span
                    class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">conditions</span><span
                    class="token punctuation">[</span><span class="token punctuation">]</span> <span
                    class="token operator">=</span> <span class="token string double-quoted-string">"name = '<span
                    class="token interpolation"><span class="token variable">$name</span></span>'"</span><span
                    class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span
                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">whereEmail</span><span class="token punctuation">(</span><span
                    class="token variable">$email</span><span class="token punctuation">)</span> <span
                    class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">conditions</span><span
                    class="token punctuation">[</span><span class="token punctuation">]</span> <span
                    class="token operator">=</span> <span class="token string double-quoted-string">"email = '<span
                    class="token interpolation"><span class="token variable">$email</span></span>'"</span><span
                    class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span
                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">getQuery</span><span
                    class="token punctuation">(</span><span class="token punctuation">)</span> <span
                    class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string double-quoted-string">"SELECT * FROM users WHERE "</span> <span
                    class="token operator">.</span> <span class="token function">implode</span><span
                    class="token punctuation">(</span><span
                    class="token string single-quoted-string">' AND '</span><span
                    class="token punctuation">,</span> <span class="token variable">$this</span><span
                    class="token operator">-&gt;</span><span class="token property">conditions</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Использование</span>
<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span
                    class="token class-name">UserQuery</span><span class="token punctuation">(</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span
                    class="token variable">$query</span><span class="token operator">-&gt;</span><span
                    class="token function">whereName</span><span class="token punctuation">(</span><span
                    class="token string single-quoted-string">'John Doe'</span><span
                    class="token punctuation">)</span><span class="token operator">-&gt;</span><span
                    class="token function">whereEmail</span><span class="token punctuation">(</span><span
                    class="token string single-quoted-string">'john@example.com'</span><span
                    class="token punctuation">)</span><span class="token operator">-&gt;</span><span
                    class="token function">getQuery</span><span class="token punctuation">(</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$sql</span><span class="token punctuation">;</span> <span
                    class="token comment">// SELECT * FROM users WHERE name = 'John Doe' AND email = 'john@example.com'</span></pre>
    </div>
    <p><strong>Плюсы:</strong></p>
    <ul>
        <li><p>Упрощение построения сложных запросов.</p></li>
        <li><p>Повторное использование кода.</p></li>
    </ul>
    <p><strong>Минусы:</strong></p>
    <ul>
        <li><p>Дополнительный уровень абстракции.</p></li>
    </ul>
    <hr>
    <h3>6. <strong>Identity Map</strong></h3>
    <p>Этот шаблон гарантирует, что каждый объект загружается только один раз, даже если на него ссылаются несколько
        раз.</p>
    <p><strong>Пример:</strong></p>
    <div class="md-code-block">
        <div class="md-code-block-banner-wrap">
            <div class="md-code-block-banner">
                <div class="md-code-block-infostring">php</div>
                <div class="md-code-block-action">
                    <div class="ds-markdown-code-copy-button">Copy</div>
                </div>
            </div>
        </div>
        <pre><span class="token keyword">class</span> <span
                class="token class-name-definition class-name">IdentityMap</span> <span
                class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$objects</span> <span
                    class="token operator">=</span> <span class="token punctuation">[</span><span
                    class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">add</span><span class="token punctuation">(</span><span
                    class="token variable">$id</span><span class="token punctuation">,</span> <span
                    class="token variable">$object</span><span class="token punctuation">)</span> <span
                    class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">objects</span><span
                    class="token punctuation">[</span><span class="token variable">$id</span><span
                    class="token punctuation">]</span> <span class="token operator">=</span> <span
                    class="token variable">$object</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">get</span><span class="token punctuation">(</span><span
                    class="token variable">$id</span><span class="token punctuation">)</span> <span
                    class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span
                    class="token property">objects</span><span class="token punctuation">[</span><span
                    class="token variable">$id</span><span class="token punctuation">]</span> <span
                    class="token operator">??</span> <span class="token constant">null</span><span
                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Использование</span>
<span class="token variable">$map</span> <span class="token operator">=</span> <span
                    class="token keyword">new</span> <span class="token class-name">IdentityMap</span><span
                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span
                    class="token keyword">new</span> <span class="token class-name">User</span><span
                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
<span class="token variable">$map</span><span class="token operator">-&gt;</span><span class="token function">add</span><span
                    class="token punctuation">(</span><span class="token number">1</span><span
                    class="token punctuation">,</span> <span class="token variable">$user</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$sameUser</span> <span class="token operator">=</span> <span
                    class="token variable">$map</span><span class="token operator">-&gt;</span><span
                    class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span> <span
                    class="token comment">// Возвращает тот же объект</span></pre>
    </div>
    <p><strong>Плюсы:</strong></p>
    <ul>
        <li><p>Исключение дублирования объектов.</p></li>
        <li><p>Повышение производительности.</p></li>
    </ul>
    <p><strong>Минусы:</strong></p>
    <ul>
        <li><p>Увеличение потребления памяти.</p></li>
    </ul>
    <hr>
    <h3>7. <strong>Lazy Load</strong></h3>
    <p>Этот шаблон откладывает загрузку связанных данных до момента их фактического использования.</p>
    <p><strong>Пример:</strong></p>
    <div class="md-code-block">
        <div class="md-code-block-banner-wrap">
            <div class="md-code-block-banner">
                <div class="md-code-block-infostring">php</div>
                <div class="md-code-block-action">
                    <div class="ds-markdown-code-copy-button">Copy</div>
                </div>
            </div>
        </div>
        <pre><span class="token keyword">class</span> <span
                class="token class-name-definition class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$posts</span><span
                    class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">getPosts</span><span
                    class="token punctuation">(</span><span class="token punctuation">)</span> <span
                    class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span
                    class="token variable">$this</span><span class="token operator">-&gt;</span><span
                    class="token property">posts</span> <span class="token operator">===</span> <span
                    class="token constant">null</span><span class="token punctuation">)</span> <span
                    class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span
                    class="token property">posts</span> <span class="token operator">=</span> <span
                    class="token variable">$this</span><span class="token operator">-&gt;</span><span
                    class="token function">loadPosts</span><span class="token punctuation">(</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span
                    class="token property">posts</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span
                    class="token function-definition function">loadPosts</span><span
                    class="token punctuation">(</span><span class="token punctuation">)</span> <span
                    class="token punctuation">{</span>
        <span class="token comment">// Логика загрузки постов из базы данных</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Использование</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span
                    class="token keyword">new</span> <span class="token class-name">User</span><span
                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                    class="token punctuation">;</span>
<span class="token variable">$posts</span> <span class="token operator">=</span> <span
                    class="token variable">$user</span><span class="token operator">-&gt;</span><span
                    class="token function">getPosts</span><span class="token punctuation">(</span><span
                    class="token punctuation">)</span><span class="token punctuation">;</span> <span
                    class="token comment">// Данные загружаются только при вызове getPosts()</span></pre>
    </div>
    <p><strong>Плюсы:</strong></p>
    <ul>
        <li><p>Экономия ресурсов.</p></li>
        <li><p>Ускорение начальной загрузки.</p></li>
    </ul>
    <p><strong>Минусы:</strong></p>
    <ul>
        <li><p>Риск возникновения N+1 проблемы.</p></li>
    </ul>
    <hr>
    <h3>Заключение</h3>
    <p>Выбор шаблона зависит от сложности проекта, требований к производительности и предпочтений разработчика. Active
        Record подходит для небольших проектов, а Data Mapper и Repository — для более сложных систем.</p></div>
</body>
</html>
